let domain = "http://heestand.xyz"
let imageSize = [2732, 2048]
let coordinateScale = 0.975
let mobileWidth = 750

let desktopCoordinates = {
  "buttons" : [
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Effects in SwiftUI, powered by Metal",
        "title" : "MetalUI",
        "url" : "https://github.com/heestand-xyz/MetalUI"
      },
      "frame" : [
        [
          818,
          447
        ],
        [
          466,
          96
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "2D & 3D graphics in Swift & Metal",
        "title" : "Async Graphics",
        "url" : "https://github.com/heestand-xyz/AsyncGraphics"
      },
      "frame" : [
        [
          336,
          447
        ],
        [
          466,
          96
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Remote control list builder",
        "title" : "Clean OSC",
        "url" : "https://apps.apple.com/us/app/clean-osc-with-files/id1550516814"
      },
      "frame" : [
        [
          978.6666666666666,
          334
        ],
        [
          305.33333333333337,
          97
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Mixing color channels with multiple images",
        "title" : "Channel Mix",
        "url" : "https://apps.apple.com/us/app/channel-mix/id1640290579"
      },
      "frame" : [
        [
          657.3333333333334,
          334
        ],
        [
          305.33333333333337,
          97
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Infinitely scrollable calendar",
        "title" : "uCal",
        "url" : "https://apps.apple.com/us/app/ucal-calendar/id1615292683"
      },
      "frame" : [
        [
          336,
          334
        ],
        [
          305.33333333333326,
          97
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Remote control UI builder",
        "title" : "Jockey OSC",
        "url" : "https://apps.apple.com/us/app/jockey-osc/id1553621603"
      },
      "frame" : [
        [
          978.6666666666666,
          221
        ],
        [
          305.33333333333337,
          97
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Crop screenshots magnetically",
        "title" : "Magnet Crop",
        "url" : "https://apps.apple.com/us/app/magnet-crop/id1547800025"
      },
      "frame" : [
        [
          657.3333333333334,
          221
        ],
        [
          305.33333333333337,
          97
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Multi exposure effect camera app",
        "title" : "HDR Camera",
        "url" : "https://apps.apple.com/us/app/hdr-effect-camera/id1580227677"
      },
      "frame" : [
        [
          336,
          221
        ],
        [
          305.33333333333326,
          97
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Send device data over WiFi",
        "title" : "Data OSC",
        "url" : "https://apps.apple.com/app/data-osc/id6447833736"
      },
      "frame" : [
        [
          978.6666666666666,
          108
        ],
        [
          305.33333333333337,
          97
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Video composer with layers on a timeline",
        "title" : "Render",
        "url" : "https://apps.apple.com/us/app/render-video-composer/id6444799341"
      },
      "frame" : [
        [
          657.3333333333334,
          108
        ],
        [
          305.33333333333337,
          97
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Create with no code.",
        "title" : "Flow Nodes",
        "url" : "https://apps.apple.com/se/app/flow-nodes/id6501975062?l=en-GB"
      },
      "frame" : [
        [
          336,
          108
        ],
        [
          305.33333333333326,
          97
        ]
      ]
    },
    {
      "cornerRadius" : 12,
      "detail" : {
        "title" : "GitHub",
        "url" : "https://github.com/heestand-xyz"
      },
      "frame" : [
        [
          164,
          348
        ],
        [
          124,
          36.5
        ]
      ]
    },
    {
      "cornerRadius" : 12,
      "detail" : {
        "title" : "LinkedIn",
        "url" : "https://www.linkedin.com/in/antonheestand/"
      },
      "frame" : [
        [
          32,
          348
        ],
        [
          124,
          36.5
        ]
      ]
    },
    {
      "cornerRadius" : 12,
      "detail" : {
        "title" : "Email",
        "url" : "mailto:anton.heestand@gmail.com"
      },
      "frame" : [
        [
          164,
          303
        ],
        [
          124,
          37
        ]
      ]
    },
    {
      "cornerRadius" : 12,
      "detail" : {
        "title" : "Resume",
        "url" : "http://heestand.xyz/CV%20Anton%20Heestand.pdf"
      },
      "frame" : [
        [
          32,
          303
        ],
        [
          124,
          37
        ]
      ]
    },
    {
      "cornerRadius" : 20,
      "detail" : {
        "title" : "heestand_xyz",
        "url" : "https://x.com/heestand_xyz"
      },
      "frame" : [
        [
          632,
          677
        ],
        [
          173.5,
          56
        ]
      ]
    },
    {
      "cornerRadius" : 20,
      "detail" : {
        "title" : "heestand",
        "url" : "https://threads.net/@heestand"
      },
      "frame" : [
        [
          494.5,
          677
        ],
        [
          137,
          56
        ]
      ]
    }
  ],
  "size" : [
    1300,
    700
  ]
}

let mobileCoordinates = {
  "buttons" : [
    {
      "cornerRadius" : 12,
      "detail" : {
        "title" : "GitHub",
        "url" : "https://github.com/heestand-xyz"
      },
      "frame" : [
        [
          204,
          301
        ],
        [
          164,
          36.5
        ]
      ]
    },
    {
      "cornerRadius" : 12,
      "detail" : {
        "title" : "LinkedIn",
        "url" : "https://www.linkedin.com/in/antonheestand/"
      },
      "frame" : [
        [
          32,
          301
        ],
        [
          164,
          36.5
        ]
      ]
    },
    {
      "cornerRadius" : 12,
      "detail" : {
        "title" : "Email",
        "url" : "mailto:anton.heestand@gmail.com"
      },
      "frame" : [
        [
          204,
          256
        ],
        [
          164,
          37
        ]
      ]
    },
    {
      "cornerRadius" : 12,
      "detail" : {
        "title" : "Resume",
        "url" : "http://heestand.xyz/CV%20Anton%20Heestand.pdf"
      },
      "frame" : [
        [
          32,
          256
        ],
        [
          164,
          37
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "2D & 3D graphics in Swift & Metal",
        "title" : "Async Graphics",
        "url" : "https://github.com/heestand-xyz/AsyncGraphics"
      },
      "frame" : [
        [
          16,
          640
        ],
        [
          368,
          96
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Remote control UI builder",
        "title" : "Jockey OSC",
        "url" : "https://apps.apple.com/us/app/jockey-osc/id1553621603"
      },
      "frame" : [
        [
          16,
          528
        ],
        [
          368,
          96
        ]
      ]
    },
    {
      "cornerRadius" : 24,
      "detail" : {
        "info" : "Create with no code.",
        "title" : "Flow Nodes",
        "url" : "https://apps.apple.com/se/app/flow-nodes/id6501975062?l=en-GB"
      },
      "frame" : [
        [
          16,
          416
        ],
        [
          368,
          96
        ]
      ]
    },
    {
      "cornerRadius" : 20,
      "detail" : {
        "title" : "heestand_xyz",
        "url" : "https://x.com/heestand_xyz"
      },
      "frame" : [
        [
          182,
          777
        ],
        [
          173.5,
          56
        ]
      ]
    },
    {
      "cornerRadius" : 20,
      "detail" : {
        "title" : "heestand",
        "url" : "https://threads.net/@heestand"
      },
      "frame" : [
        [
          44.5,
          777
        ],
        [
          137,
          56
        ]
      ]
    }
  ],
  "size" : [
    400,
    800
  ]
}

let canvasBackground = document.getElementsByClassName('canvasBackground')[0];
let canvasForeground = document.getElementsByClassName('canvasForeground')[0];

let desktopMainFrame = document.getElementsByClassName('desktopMainFrame')[0];
let mobileMainFrame = document.getElementsByClassName('mobileMainFrame')[0];

let spinner = document.getElementsByClassName('spinner')[0];

let isMobile = function() {
  return window.innerWidth < mobileWidth
}
let targetZoom = function() {
  if (isMobile()) {
    return 2.0
  } else {
    return 1.5
  }
}

var isAnimated = false
var zoom = 1.0;

for (var i = 0; i < desktopCoordinates.buttons.length; i++) {
  let button = desktopCoordinates.buttons[i]
  let link = document.createElement("a");
  link.classList.add('area');
  link.href = button.detail.url;
  desktopMainFrame.appendChild(link);
}

for (var i = 0; i < mobileCoordinates.buttons.length; i++) {
  let button = mobileCoordinates.buttons[i]
  let link = document.createElement("a");
  link.classList.add('area');
  link.href = button.detail.url;
  mobileMainFrame.appendChild(link);
}

let resize = function(event) {
  
  if (isAnimated) {
    if (isMobile()) {
      mobileMainFrame.style.opacity = 1.0;
      desktopMainFrame.style.opacity = 0.0;
      mobileMainFrame.style.display = "block";
      desktopMainFrame.style.display = "none";
    } else {
      desktopMainFrame.style.opacity = 1.0;
      mobileMainFrame.style.opacity = 0.0;
      desktopMainFrame.style.display = "block";
      mobileMainFrame.style.display = "none";
    }  
  }
  
  let windowSize = [window.innerWidth, window.innerHeight]
      
  let windowAspectRatio = windowSize[0] / windowSize[1]
  let imageAspectRatio = imageSize[0] / imageSize[1]

  let imageWidth = 0
  let imageHeight = 0
  if (imageAspectRatio > windowAspectRatio) {
    imageWidth = windowSize[1] * imageAspectRatio
    imageHeight = windowSize[1]
  } else {
    imageWidth = windowSize[0]
    imageHeight = windowSize[0] / imageAspectRatio
  }

  // canvasBackground.width = imageWidth * zoom;
  // canvasBackground.height = imageHeight * zoom;
  canvasForeground.width = imageWidth * zoom;
  canvasForeground.height = imageHeight * zoom;

  let resizeAreas = function(mainFrame, coordinates) {
    
    var mainWidth = (coordinates.size[0] * coordinateScale * zoom)
    var mainHeight = (coordinates.size[1] * coordinateScale * zoom)

    if (imageAspectRatio > windowAspectRatio) {
      mainWidth = (mainWidth / imageSize[0]) * windowSize[1] * imageAspectRatio;
      mainHeight = (mainHeight / imageSize[1]) * windowSize[1];
    } else {
      mainWidth = (mainWidth / imageSize[0]) * windowSize[0];
      mainHeight = (mainHeight / imageSize[1]) * windowSize[0] / imageAspectRatio;
    }

    mainFrame.style.width = mainWidth + "px"
    mainFrame.style.height = mainHeight + "px"

    let linkScale = mainHeight / coordinates.size[1]

    let links = mainFrame.getElementsByTagName("a")
    
    for (var i = 0; i < coordinates.buttons.length; i++) {
      let button = coordinates.buttons[i]
      for (var i = 0; i < links.length; i++) {
        if (links[i].getAttribute("href") == button.detail.url) {
          let link = links[i];
          link.style.left = (button.frame[0][0] * linkScale) + "px";
          link.style.top = (button.frame[0][1] * linkScale) + "px";
          link.style.width = (button.frame[1][0] * linkScale) + "px";
          link.style.height = (button.frame[1][1] * linkScale) + "px";
          link.style.borderRadius = (button.cornerRadius * linkScale) + "px";
          break;
        }
      }
    }
  }
  resizeAreas(desktopMainFrame, desktopCoordinates)
  resizeAreas(mobileMainFrame, mobileCoordinates)
};

window.onresize = resize
resize()

// var didLoadBackground = false
// let backgroundLoaded = function() {
//   didLoadBackground = true
//   if (didLoadForeground) {
//     loaded()
//   }
// } 

var didLoadForeground = false
let foregroundLoaded = function() {
  if (didLoadForeground) { return }
  didLoadForeground = true
  spinner.remove();
  loaded()
}

let loaded = function() {
  var opacity = 0.0
  if (isMobile()) {
    mobileMainFrame.style.display = "block";
    desktopMainFrame.style.display = "none";
  } else {
    desktopMainFrame.style.display = "block";
    mobileMainFrame.style.display = "none";
  }
  let fade = setInterval(() => {
    opacity += .0075
    let smoothFraction = Math.cos(opacity * Math.PI + Math.PI) / 2.0 + 0.5;
    canvasForeground.style.opacity = smoothFraction;
    if (isMobile()) {
      mobileMainFrame.style.opacity = smoothFraction;
    } else {
      desktopMainFrame.style.opacity = smoothFraction;
    }
    zoom = 1.0 - smoothFraction + targetZoom() * smoothFraction;
    resize();
    if (opacity >= 1) {
        clearInterval(fade);
        isAnimated = true
    }
  }, 10);
}
